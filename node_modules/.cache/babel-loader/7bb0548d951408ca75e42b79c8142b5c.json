{"ast":null,"code":"import { storage } from \"./storage\";\nimport axios from \"axios\";\nexport const useApi = function () {\n  let baseUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"localhost\";\n  let useToken = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  axios.interceptors.request.use(request => {\n    const token = storage.getCache(\"token\");\n    request.baseURL = baseUrl;\n    request.headers.post[\"Content-Type\"] = \"x-www-form-urlencoded\"; // request.headers.post[\"Content-Type\"] = \"application/json\";\n    // console.log(\"config\", request.headers);\n\n    if (token) {\n      // axios.defaults.headers.common['Authorization'] = `Beare ${token}`\n      request.headers[\"Authorization\"] = `Beare ${token}`;\n    }\n\n    return request;\n  }, error => {\n    return Promise.reject(error);\n  });\n  axios.interceptors.response.use(function (response) {\n    // Any status code that lie within the range of 2xx cause this function to trigger\n    // Do something with response data\n    // return {response: response.data, success: response.ok}; But when call > 2 times, it will be underfined\n    return response;\n  }, function (error) {\n    // Any status codes that falls outside the range of 2xx cause this function to trigger\n    // Do something with response error\n    if (error.response.status == 401) {\n      return {\n        response: {\n          message: resources.auth.authorize\n        },\n        success: false\n      };\n    }\n\n    if (error.response.status == 403) {\n      return {\n        response: {\n          message: resources.auth.forbidden\n        },\n        success: false\n      };\n    }\n\n    if (error.response.status == 404) {\n      return {\n        response: {\n          message: resources.generalError\n        },\n        success: false\n      };\n    }\n\n    if (error.response.status == 500) {\n      return {\n        response: {\n          message: json.message\n        },\n        success: response.ok\n      };\n    }\n\n    if (!response.ok && error.response.status !== 400 && response) {\n      return Promise.reject(response);\n    }\n  });\n  return axios;\n};\n\nfunction addCache(key, v) {\n  localStorage.setItem(key, JSON.stringify(v));\n}\n\nfunction getCache(key) {\n  try {\n    let v = localStorage.getItem(key);\n    return JSON.parse(v);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction removeCache(key) {\n  localStorage.removeItem(key);\n}\n\nfunction getToken() {\n  return getCache(\"token\");\n}\n\nexport const api = {\n  getCache,\n  addCache,\n  removeCache\n};","map":{"version":3,"names":["storage","axios","useApi","baseUrl","useToken","interceptors","request","use","token","getCache","baseURL","headers","post","error","Promise","reject","response","status","message","resources","auth","authorize","success","forbidden","generalError","json","ok","addCache","key","v","localStorage","setItem","JSON","stringify","getItem","parse","e","removeCache","removeItem","getToken","api"],"sources":["/Users/nguyenquocquy/Documents/ThaÌ€nh Project/Front-end/src/service/api.js"],"sourcesContent":["import { storage } from \"./storage\";\nimport axios from \"axios\";\n\nexport const useApi = (baseUrl = \"localhost\", useToken = false) => {\n  axios.interceptors.request.use(\n    (request) => {\n      const token = storage.getCache(\"token\");\n      request.baseURL = baseUrl;\n      request.headers.post[\"Content-Type\"] = \"x-www-form-urlencoded\";\n      // request.headers.post[\"Content-Type\"] = \"application/json\";\n      // console.log(\"config\", request.headers);\n      if (token) {\n        // axios.defaults.headers.common['Authorization'] = `Beare ${token}`\n        request.headers[\"Authorization\"] = `Beare ${token}`;\n      }\n      return request;\n    },\n    (error) => {\n      return Promise.reject(error);\n    }\n  );\n  axios.interceptors.response.use(\n    function (response) {\n      // Any status code that lie within the range of 2xx cause this function to trigger\n      // Do something with response data\n      // return {response: response.data, success: response.ok}; But when call > 2 times, it will be underfined\n      return response;\n    },\n    function (error) {\n      // Any status codes that falls outside the range of 2xx cause this function to trigger\n      // Do something with response error\n      if (error.response.status == 401) {\n        return {\n          response: { message: resources.auth.authorize },\n          success: false,\n        };\n      }\n\n      if (error.response.status == 403) {\n        return {\n          response: { message: resources.auth.forbidden },\n          success: false,\n        };\n      }\n      if (error.response.status == 404) {\n        return {\n          response: { message: resources.generalError },\n          success: false,\n        };\n      }\n\n      if (error.response.status == 500) {\n        return { response: { message: json.message }, success: response.ok };\n      }\n\n      if (!response.ok && error.response.status !== 400 && response) {\n        return Promise.reject(response);\n      }\n    }\n  );\n\n  return axios;\n};\n\nfunction addCache(key, v) {\n  localStorage.setItem(key, JSON.stringify(v));\n}\n\nfunction getCache(key) {\n  try {\n    let v = localStorage.getItem(key);\n    return JSON.parse(v);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction removeCache(key) {\n  localStorage.removeItem(key);\n}\n\nfunction getToken() {\n  return getCache(\"token\");\n}\n\nexport const api = {\n  getCache,\n  addCache,\n  removeCache,\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}